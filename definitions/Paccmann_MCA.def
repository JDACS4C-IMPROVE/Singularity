Bootstrap: docker
From: pytorch/pytorch:1.0.1-cuda10.0-cudnn7-devel

# pytorch/pytorch:1.10.0-cuda11.3-cudnn8-devel

%labels
	MANTAINER Tom Brettin, Priyanka

%setup
	cp ../src/Singularity_gpu_fix.sh $SINGULARITY_ROOTFS
%post
	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F60F4B3D7FA2AF80
	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A4B469963BF863CC
	apt-get update

	apt-get install wget -y
	apt-get install git -y

	chmod +x Singularity_gpu_fix.sh
        ./Singularity_gpu_fix.sh

	pip install git+https://github.com/ECP-CANDLE/candle_lib@candle_data_dir

	# pip install rdkit=2019.03.1 Use conda, there is no pip package for this ver
	cd /usr/local
	wget https://repo.anaconda.com/miniconda/Miniconda3-py37_4.12.0-Linux-x86_64.sh
	chmod u+x Miniconda3-py37_4.12.0-Linux-x86_64.sh
	./Miniconda3-py37_4.12.0-Linux-x86_64.sh -b -p /usr/local/miniconda37

	/opt/conda/bin/conda create -y -p /usr/local/conda_envs/Paccmann_MCA
	source /opt/conda/bin/activate /usr/local/conda_envs/Paccmann_MCA
	conda install -y -c conda-forge rdkit=2019.03.1

	#  PYTHONPATH=/opt/conda/lib/python3.7/site-packages python ./train_paccmann2.py 	

	pip install git+https://github.com/PaccMann/paccmann_datasets@0.0.3

	cd /usr/local/
	git clone https://github.com/JDACS4C-IMPROVE/Paccmann_MCA
	cd Paccmann_MCA
	git checkout develop
	#cp train.sh /usr/local/bin 

