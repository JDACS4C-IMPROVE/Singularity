# Bootstrap: localimage
# From: /home/brettin/Singularity/images/improve-tensorflow-gpu-1.15:0.0.1-20221019.sif

Bootstrap: docker
From: tensorflow/tensorflow:1.15.5-gpu

%labels
	MAINTAINER Tom Brettin

%setup
	# git clone https://github.com/JDACS4C-IMPROVE/DrugGCN.git $SINGULARITY_ROOTFS/usr/local/DrugGCN
	cp ./src/Singularity_gpu_fix.sh $SINGULARITY_ROOTFS

%post
	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F60F4B3D7FA2AF80
    	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A4B469963BF863CC
	apt-get update -y
	apt-get install -y git
	apt-get install -y vim

	chmod +x Singularity_gpu_fix.sh
	./Singularity_gpu_fix.sh

	mkdir /candle_data_dir

	python3 -m pip install git+https://github.com/ECP-CANDLE/candle_lib@develop
	python3 -m pip install pyyaml
	python3 -m pip install scikit-learn
	python3 -m pip install gensim
	python3 -m pip install dataclasses
	python3 -m pip install cvxopt

	git clone https://github.com/JDACS4C-IMPROVE/DrugGCN.git /usr/local/DrugGCN
    cd /usr/local/DrugGCN
    git checkout develop
